<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Human Robot Football Locks - AI Betting Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 48px;
        }

        .logo-text {
            display: flex;
            flex-direction: column;
        }

        .logo-title {
            font-size: 32px;
            font-weight: 800;
            background: linear-gradient(45deg, #00d4ff, #5b63d3);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-subtitle {
            font-size: 12px;
            color: #64748b;
            font-style: italic;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 4px;
        }

        .nav-tab {
            padding: 10px 20px;
            border: none;
            background: transparent;
            color: #94a3b8;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 14px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6, #00d4ff);
            color: white;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .control-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #60a5fa);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-ai {
            background: linear-gradient(135deg, #00d4ff, #0891b2);
            color: white;
        }

        .status-text {
            color: #94a3b8;
            font-size: 14px;
        }

        .credits-display {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            color: #94a3b8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
        }
        
        .stat-card.clickable {
            cursor: pointer;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }
        
        .stat-card.clickable:hover {
            background: rgba(0, 212, 255, 0.1);
            transform: translateY(-4px);
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(45deg, #00d4ff, #5b63d3);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
        
        .filters-panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .grade-filters {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .grade-filter-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #94a3b8;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        
        .grade-filter-btn.active {
            background: linear-gradient(135deg, #3b82f6, #00d4ff);
            color: white;
            border-color: transparent;
        }
        
        .sort-controls {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .sort-select {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .sort-select option {
            background: #1a1a2e;
        }

        .bets-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bet-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .bet-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .bet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .bet-title {
            font-weight: 600;
            font-size: 16px;
        }

        .grade-badge {
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 700;
        }

        .grade-a-plus { background: #10b981; color: white; }
        .grade-a { background: #34d399; color: white; }
        .grade-a-minus { background: #6ee7b7; color: #065f46; }
        .grade-b-plus { background: #3b82f6; color: white; }
        .grade-b { background: #60a5fa; color: white; }
        .grade-b-minus { background: #93c5fd; color: #1e3a8a; }
        .grade-c-plus { background: #f59e0b; color: white; }
        .grade-c { background: #fbbf24; color: #78350f; }
        .grade-c-minus { background: #fde68a; color: #78350f; }
        .grade-d { background: #fb923c; color: white; }
        .grade-f { background: #ef4444; color: white; }

        .bet-details {
            margin: 12px 0;
            color: #e2e8f0;
        }

        .bet-line {
            font-size: 20px;
            font-weight: 600;
            margin: 8px 0;
        }

        .bet-odds {
            color: #94a3b8;
            font-size: 14px;
        }

        .confidence-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 8px;
            border-radius: 4px;
            margin: 12px 0;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #5b63d3);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .confidence-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #94a3b8;
        }

        .lock-time {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 8px;
        }

        .add-to-tracker {
            width: 100%;
            padding: 8px;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            color: #60a5fa;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 12px;
            transition: all 0.3s ease;
        }

        .add-to-tracker:hover {
            background: rgba(59, 130, 246, 0.3);
        }

        .trends-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .trend-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .trend-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #00d4ff;
        }

        .trend-table {
            width: 100%;
            font-size: 14px;
        }

        .trend-table th {
            text-align: left;
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 12px;
            text-transform: uppercase;
        }

        .trend-table td {
            padding: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #94a3b8;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
            }
            
            .bets-container {
                grid-template-columns: 1fr;
            }
            
            .trends-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">🤖</div>
                <div class="logo-text">
                    <div class="logo-title">Human Robot Football Locks</div>
                    <div class="logo-subtitle">presented by Matty Shmealington Industries</div>
                </div>
            </div>
            
            <div class="search-container">
                <span class="search-icon">🔍</span>
                <input type="text" class="search-input" placeholder="Search teams, games, players..." id="searchInput">
            </div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="switchTab('nfl-props')">NFL Props</button>
                <button class="nav-tab" onclick="switchTab('college')">College Bets</button>
                <button class="nav-tab" onclick="switchTab('line-movements')">Line Movements</button>
                <button class="nav-tab" onclick="switchTab('results')">Results & Trends</button>
                <button class="nav-tab" onclick="switchTab('settings')">Settings</button>
            </div>
        </div>
        
        <div class="controls-panel">
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="fetchAllData()">
                    🔄 Fetch Live Data
                </button>
                <button class="btn btn-ai" onclick="runAIAnalysis()">
                    🧠 Run AI Analysis
                </button>
            </div>
            <div class="status-text" id="status">Ready to fetch data</div>
            <div class="credits-display">Credits: <span id="credits">100,000</span> available</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="nflPropsCount">0</div>
                    <div class="stat-label">NFL Props Analyzed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="collegeGamesCount">0</div>
                    <div class="stat-label">College Games</div>
                </div>
                <div class="stat-card clickable" onclick="showAPlusBets()">
                    <div class="stat-value" id="aPlusBetsCount">0</div>
                    <div class="stat-label">A+ Grade Bets (Click to View)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgEdge">+0%</div>
                    <div class="stat-label">Average Edge</div>
                </div>
            </div>
            
            <div id="dashboardContent">
                <div class="loading">
                    <div>Click "Fetch Live Data" to load current betting lines</div>
                    <div>Then click "Run AI Analysis" to get graded predictions</div>
                </div>
            </div>
        </div>
        
        <!-- NFL Props Tab -->
        <div id="nfl-props" class="tab-content">
            <h2 style="margin-bottom: 20px;">NFL Player Props</h2>
            
            <div class="filters-panel">
                <div class="grade-filters">
                    <span style="color: #94a3b8; font-size: 14px; margin-right: 12px;">Filter by Grade:</span>
                    <button class="grade-filter-btn active" onclick="setNFLFilter('high')" id="nfl-filter-high">A+ to B-</button>
                    <button class="grade-filter-btn" onclick="setNFLFilter('all')" id="nfl-filter-all">All Grades</button>
                    <button class="grade-filter-btn" onclick="setNFLFilter('a-only')" id="nfl-filter-a">A Grades Only</button>
                </div>
                <div class="sort-controls">
                    <span style="color: #94a3b8; font-size: 14px;">Sort by:</span>
                    <select class="sort-select" id="nfl-sort" onchange="sortNFLProps()">
                        <option value="grade">Best Grade First</option>
                        <option value="time">Starting Soonest</option>
                    </select>
                </div>
            </div>
            
            <div class="bets-container" id="nflPropsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading NFL player props...</div>
                </div>
            </div>
        </div>
        
        <!-- College Bets Tab -->
        <div id="college" class="tab-content">
            <h2 style="margin-bottom: 20px;">College Football Bets</h2>
            
            <div class="filters-panel">
                <div class="grade-filters">
                    <span style="color: #94a3b8; font-size: 14px; margin-right: 12px;">Filter by Grade:</span>
                    <button class="grade-filter-btn active" onclick="setCollegeFilter('high')" id="college-filter-high">A+ to B-</button>
                    <button class="grade-filter-btn" onclick="setCollegeFilter('all')" id="college-filter-all">All Grades</button>
                    <button class="grade-filter-btn" onclick="setCollegeFilter('a-only')" id="college-filter-a">A Grades Only</button>
                </div>
                <div class="sort-controls">
                    <span style="color: #94a3b8; font-size: 14px;">Sort by:</span>
                    <select class="sort-select" id="college-sort" onchange="sortCollegeBets()">
                        <option value="grade">Best Grade First</option>
                        <option value="time">Starting Soonest</option>
                    </select>
                </div>
            </div>
            
            <div class="bets-container" id="collegeContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading college football lines...</div>
                </div>
            </div>
        </div>
        
        <!-- A+ Bets Tab (Hidden by default) -->
        <div id="a-plus-bets" class="tab-content">
            <div style="margin-bottom: 20px;">
                <button class="btn" onclick="switchTab('dashboard')" style="background: rgba(255, 255, 255, 0.1); margin-bottom: 20px;">
                    ← Back to Dashboard
                </button>
                <h2 style="color: #10b981;">🏆 A+ Grade Bets Only</h2>
            </div>
            <div class="bets-container" id="aPlusBetsContainer">
                <div class="loading">No A+ bets available. Run AI Analysis first.</div>
            </div>
        </div>
        
        <!-- Line Movements Tab -->
        <div id="line-movements" class="tab-content">
            <h2 style="margin-bottom: 20px;">Line Movements</h2>
            <div id="lineMovementsContainer">
                <div class="loading">Line movement tracking coming soon...</div>
            </div>
        </div>
        
        <!-- Results & Trends Tab -->
        <div id="results" class="tab-content">
            <h2 style="margin-bottom: 20px;">Results & Trends</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="overallWinRate">0%</div>
                    <div class="stat-label">Overall Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTracked">0</div>
                    <div class="stat-label">Total Bets Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="profitLoss">+0</div>
                    <div class="stat-label">Units Profit/Loss</div>
                </div>
            </div>
            
            <div class="trends-container">
                <div class="trend-section">
                    <div class="trend-title">Winning % by Letter Grade</div>
                    <table class="trend-table">
                        <thead>
                            <tr>
                                <th>Grade</th>
                                <th>Win %</th>
                                <th>Record</th>
                            </tr>
                        </thead>
                        <tbody id="gradeStatsBody">
                            <tr><td colspan="3" style="text-align: center; color: #64748b;">No data yet</td></tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="trend-section">
                    <div class="trend-title">Top Performing Bet Types</div>
                    <table class="trend-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Win %</th>
                                <th>Record</th>
                            </tr>
                        </thead>
                        <tbody id="betTypeStatsBody">
                            <tr><td colspan="3" style="text-align: center; color: #64748b;">No data yet</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2 style="margin-bottom: 20px;">API Settings</h2>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 12px;">
                <p style="color: #10b981; margin-bottom: 10px;">✓ API Key Active</p>
                <p style="color: #64748b; font-size: 14px;">Key: 515fda69abaa6088d32dcfbc0b00d2e9</p>
                <p style="color: #64748b; font-size: 14px;">Monthly Credits: 100,000</p>
            </div>
        </div>
    </div>

    <script>
        // Global data storage
        let nflPropsData = [];
        let collegeData = [];
        let trackedBets = JSON.parse(localStorage.getItem('trackedBets')) || [];
        const API_KEY = '515fda69abaa6088d32dcfbc0b00d2e9';
        
        // Filter states
        let nflFilterMode = 'high'; // 'high' = A+ to B-, 'all' = all grades, 'a-only' = A grades only
        let collegeFilterMode = 'high';
        let nflSortMode = 'grade'; // 'grade' or 'time'
        let collegeSortMode = 'grade';
        
        // Grade rankings for filtering and sorting
        const gradeRanks = {
            'A+': 13, 'A': 12, 'A-': 11,
            'B+': 10, 'B': 9, 'B-': 8,
            'C+': 7, 'C': 6, 'C-': 5,
            'D': 4, 'F': 3
        };
        
        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            // Find and activate the correct nav tab
            if (tabName !== 'a-plus-bets') {
                const navTabs = document.querySelectorAll('.nav-tab');
                navTabs.forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(tabName.replace('-', ' ').split(' ')[0])) {
                        tab.classList.add('active');
                    }
                });
            }
            
            if (tabName === 'results') {
                updateResultsStats();
            }
        }
        
        // Show A+ Bets
        function showAPlusBets() {
            switchTab('a-plus-bets');
            renderAPlusBets();
        }
        
        // Render A+ Bets
        function renderAPlusBets() {
            const container = document.getElementById('aPlusBetsContainer');
            const allAPlusBets = [];
            
            // Collect all A+ NFL props
            nflPropsData.forEach(prop => {
                if (prop.grade === 'A+') {
                    allAPlusBets.push({
                        type: 'nfl',
                        data: prop
                    });
                }
            });
            
            // Collect all A+ college bets
            collegeData.forEach(game => {
                if (game.spreadAnalysis) {
                    game.spreadAnalysis.forEach((spread, index) => {
                        if (spread.grade === 'A+') {
                            allAPlusBets.push({
                                type: 'college-spread',
                                data: { ...game, spread, index }
                            });
                        }
                    });
                }
                if (game.totalAnalysis) {
                    game.totalAnalysis.forEach((total, index) => {
                        if (total.grade === 'A+') {
                            allAPlusBets.push({
                                type: 'college-total',
                                data: { ...game, total, index }
                            });
                        }
                    });
                }
            });
            
            if (allAPlusBets.length === 0) {
                container.innerHTML = '<div class="loading">No A+ bets found. Run AI Analysis to find premium opportunities.</div>';
                return;
            }
            
            const cards = allAPlusBets.map(bet => {
                if (bet.type === 'nfl') {
                    return createNFLPropCard(bet.data);
                } else if (bet.type === 'college-spread') {
                    return createCollegeSpreadCard(bet.data.awayTeam, bet.data.homeTeam, bet.data.gameTime, 
                                                   bet.data.spread, bet.data.id, bet.data.index);
                } else {
                    return createCollegeTotalCard(bet.data.awayTeam, bet.data.homeTeam, bet.data.gameTime, 
                                                  bet.data.total, bet.data.id, bet.data.index);
                }
            });
            
            container.innerHTML = cards.join('');
        }
        
        // NFL Filter functions
        function setNFLFilter(mode) {
            nflFilterMode = mode;
            
            // Update button states
            document.getElementById('nfl-filter-high').classList.remove('active');
            document.getElementById('nfl-filter-all').classList.remove('active');
            document.getElementById('nfl-filter-a').classList.remove('active');
            
            document.getElementById(`nfl-filter-${mode === 'a-only' ? 'a' : mode}`).classList.add('active');
            
            renderNFLProps();
        }
        
        function sortNFLProps() {
            nflSortMode = document.getElementById('nfl-sort').value;
            renderNFLProps();
        }
        
        // College Filter functions
        function setCollegeFilter(mode) {
            collegeFilterMode = mode;
            
            // Update button states
            document.getElementById('college-filter-high').classList.remove('active');
            document.getElementById('college-filter-all').classList.remove('active');
            document.getElementById('college-filter-a').classList.remove('active');
            
            document.getElementById(`college-filter-${mode === 'a-only' ? 'a' : mode}`).classList.add('active');
            
            renderCollegeGames();
        }
        
        function sortCollegeBets() {
            collegeSortMode = document.getElementById('college-sort').value;
            renderCollegeGames();
        }
        
        // Filter function to check if grade should be displayed
        function shouldShowGrade(grade, filterMode) {
            if (!grade) return filterMode === 'all';
            
            if (filterMode === 'all') return true;
            if (filterMode === 'a-only') return grade.startsWith('A');
            if (filterMode === 'high') {
                const rank = gradeRanks[grade] || 0;
                return rank >= gradeRanks['B-']; // B- or better
            }
            return false;
        }
        
        // Fetch all data
        async function fetchAllData() {
            updateStatus('Fetching live data...');
            
            try {
                // Fetch NFL player props
                await fetchNFLProps();
                
                // Fetch College games
                await fetchCollegeGames();
                
                updateStatus('Data fetched successfully! Run AI Analysis to get predictions.');
                updateDashboard();
                
            } catch (error) {
                console.error('Error fetching data:', error);
                updateStatus('Error fetching data. Check console for details.');
                // Load demo data as fallback
                loadDemoData();
            }
        }
        
        // Fetch NFL Props
        async function fetchNFLProps() {
            try {
                const response = await fetch(
                    `https://api.the-odds-api.com/v4/sports/americanfootball_nfl/events?apiKey=${API_KEY}`
                );
                
                if (!response.ok) throw new Error('API request failed');
                
                const events = await response.json();
                
                // For each event, fetch player props
                const propsPromises = events.slice(0, 5).map(async (event) => {
                    const propsResponse = await fetch(
                        `https://api.the-odds-api.com/v4/sports/americanfootball_nfl/events/${event.id}/odds?apiKey=${API_KEY}&regions=us&markets=player_pass_yds,player_rush_yds,player_receptions,player_reception_yds&oddsFormat=american`
                    );
                    
                    if (propsResponse.ok) {
                        const propsData = await propsResponse.json();
                        return processNFLProps(propsData);
                    }
                    return [];
                });
                
                const allProps = await Promise.all(propsPromises);
                nflPropsData = allProps.flat();
                renderNFLProps();
                
            } catch (error) {
                console.error('Error fetching NFL props:', error);
                loadDemoNFLProps();
            }
        }
        
        // Process NFL Props from API
        function processNFLProps(data) {
            const props = [];
            
            if (data.bookmakers && data.bookmakers.length > 0) {
                const bookmaker = data.bookmakers[0];
                
                bookmaker.markets?.forEach(market => {
                    market.outcomes?.forEach(outcome => {
                        if (outcome.description && outcome.point !== undefined) {
                            props.push({
                                id: Math.random().toString(36).substr(2, 9),
                                player: outcome.description,
                                propType: formatPropType(market.key),
                                line: outcome.point,
                                odds: outcome.price,
                                game: `${data.away_team} @ ${data.home_team}`,
                                gameTime: data.commence_time,
                                bookmaker: bookmaker.title
                            });
                        }
                    });
                });
            }
            
            return props;
        }
        
        // Format prop type for display
        function formatPropType(key) {
            const types = {
                'player_pass_yds': 'Passing Yards',
                'player_rush_yds': 'Rushing Yards',
                'player_reception_yds': 'Receiving Yards',
                'player_receptions': 'Receptions'
            };
            return types[key] || key;
        }
        
        // Fetch College Games
        async function fetchCollegeGames() {
            try {
                const response = await fetch(
                    `https://api.the-odds-api.com/v4/sports/americanfootball_ncaaf/odds?apiKey=${API_KEY}&regions=us&markets=spreads,totals&oddsFormat=american`
                );
                
                if (!response.ok) throw new Error('API request failed');
                
                const data = await response.json();
                collegeData = processCollegeGames(data);
                renderCollegeGames();
                
            } catch (error) {
                console.error('Error fetching college games:', error);
                loadDemoCollegeGames();
            }
        }
        
        // Process college games from API
        function processCollegeGames(data) {
            return data.map(game => {
                const spreads = [];
                const totals = [];
                
                if (game.bookmakers && game.bookmakers.length > 0) {
                    const bookmaker = game.bookmakers[0];
                    
                    const spreadMarket = bookmaker.markets?.find(m => m.key === 'spreads');
                    const totalMarket = bookmaker.markets?.find(m => m.key === 'totals');
                    
                    if (spreadMarket) {
                        spreadMarket.outcomes.forEach(outcome => {
                            spreads.push({
                                team: outcome.name,
                                line: outcome.point,
                                odds: outcome.price
                            });
                        });
                    }
                    
                    if (totalMarket && totalMarket.outcomes.length > 0) {
                        totals.push({
                            type: 'Over/Under',
                            line: totalMarket.outcomes[0].point,
                            overOdds: totalMarket.outcomes.find(o => o.name === 'Over')?.price || -110,
                            underOdds: totalMarket.outcomes.find(o => o.name === 'Under')?.price || -110
                        });
                    }
                }
                
                return {
                    id: game.id,
                    homeTeam: game.home_team,
                    awayTeam: game.away_team,
                    gameTime: game.commence_time,
                    spreads: spreads,
                    totals: totals
                };
            });
        }
        
        // Load demo data fallbacks
        function loadDemoData() {
            loadDemoNFLProps();
            loadDemoCollegeGames();
            updateDashboard();
        }
        
        function loadDemoNFLProps() {
            nflPropsData = [
                { id: '1', player: 'Patrick Mahomes', propType: 'Passing Yards', line: 285.5, odds: -110, game: 'BUF @ KC', gameTime: new Date().toISOString() },
                { id: '2', player: 'Josh Allen', propType: 'Passing Yards', line: 267.5, odds: -115, game: 'BUF @ KC', gameTime: new Date().toISOString() },
                { id: '3', player: 'Travis Kelce', propType: 'Receiving Yards', line: 72.5, odds: -105, game: 'BUF @ KC', gameTime: new Date().toISOString() }
            ];
            renderNFLProps();
        }
        
        function loadDemoCollegeGames() {
            collegeData = [
                {
                    id: '1',
                    homeTeam: 'Alabama',
                    awayTeam: 'Georgia',
                    gameTime: new Date().toISOString(),
                    spreads: [
                        { team: 'Alabama', line: -3.5, odds: -110 },
                        { team: 'Georgia', line: 3.5, odds: -110 }
                    ],
                    totals: [{ type: 'Over/Under', line: 58.5, overOdds: -110, underOdds: -110 }]
                },
                {
                    id: '2',
                    homeTeam: 'Ohio State',
                    awayTeam: 'Michigan',
                    gameTime: new Date().toISOString(),
                    spreads: [
                        { team: 'Ohio State', line: -7, odds: -110 },
                        { team: 'Michigan', line: 7, odds: -110 }
                    ],
                    totals: [{ type: 'Over/Under', line: 52.5, overOdds: -115, underOdds: -105 }]
                }
            ];
            renderCollegeGames();
        }
        
        // AI Analysis
        function runAIAnalysis() {
            updateStatus('Running AI analysis...');
            
            // Analyze NFL Props
            nflPropsData = nflPropsData.map(prop => ({
                ...prop,
                ...generateAIAnalysis('nfl_prop', prop)
            }));
            
            // Analyze College Games
            collegeData = collegeData.map(game => ({
                ...game,
                spreadAnalysis: game.spreads.map(spread => ({
                    ...spread,
                    ...generateAIAnalysis('college_spread', { ...game, spread })
                })),
                totalAnalysis: game.totals.map(total => ({
                    ...total,
                    ...generateAIAnalysis('college_total', { ...game, total })
                }))
            }));
            
            renderNFLProps();
            renderCollegeGames();
            updateDashboard();
            updateStatus('AI analysis complete! Check the updated predictions.');
        }
        
        // Generate AI analysis for a bet
        function generateAIAnalysis(type, data) {
            // Simulate AI confidence calculation
            const baseConfidence = 50 + Math.random() * 50;
            const factors = [];
            
            // Add analysis factors based on type
            if (type === 'nfl_prop') {
                factors.push('Recent performance trend');
                factors.push('Matchup advantage');
                factors.push('Weather conditions');
            } else if (type === 'college_spread') {
                factors.push('Home field advantage');
                factors.push('Recent ATS performance');
                factors.push('Key injuries');
            } else if (type === 'college_total') {
                factors.push('Pace of play metrics');
                factors.push('Defensive efficiency');
                factors.push('Weather impact');
            }
            
            // Calculate grade based on confidence
            let grade;
            if (baseConfidence >= 95) grade = 'A+';
            else if (baseConfidence >= 90) grade = 'A';
            else if (baseConfidence >= 85) grade = 'A-';
            else if (baseConfidence >= 80) grade = 'B+';
            else if (baseConfidence >= 75) grade = 'B';
            else if (baseConfidence >= 70) grade = 'B-';
            else if (baseConfidence >= 65) grade = 'C+';
            else if (baseConfidence >= 60) grade = 'C';
            else if (baseConfidence >= 55) grade = 'C-';
            else if (baseConfidence >= 50) grade = 'D';
            else grade = 'F';
            
            // Determine pick
            const picks = ['Over', 'Under', 'Favorite', 'Underdog'];
            const pick = picks[Math.floor(Math.random() * 2)];
            
            return {
                confidence: Math.round(baseConfidence),
                grade: grade,
                pick: pick,
                factors: factors,
                edge: (Math.random() * 10 - 2).toFixed(1)
            };
        }
        
        // Create NFL Prop Card
        function createNFLPropCard(prop) {
            const gradeClass = prop.grade ? `grade-${prop.grade.toLowerCase().replace('+', '-plus').replace('-', '-minus')}` : '';
            const gameTime = new Date(prop.gameTime).toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            
            // Calculate lock time (30 minutes before game)
            const lockTime = new Date(prop.gameTime);
            lockTime.setMinutes(lockTime.getMinutes() - 30);
            const timeToLock = lockTime - new Date();
            const hoursToLock = Math.floor(timeToLock / (1000 * 60 * 60));
            const minutesToLock = Math.floor((timeToLock % (1000 * 60 * 60)) / (1000 * 60));
            
            return `
                <div class="bet-card">
                    <div class="bet-header">
                        <div class="bet-title">${prop.player}</div>
                        ${prop.grade ? `<div class="grade-badge ${gradeClass}">${prop.grade}</div>` : ''}
                    </div>
                    <div class="bet-details">
                        <div>${prop.propType}</div>
                        <div class="bet-line">${prop.line}</div>
                        <div class="bet-odds">Odds: ${prop.odds > 0 ? '+' : ''}${prop.odds}</div>
                        <div style="margin-top: 8px; font-size: 13px; color: #94a3b8;">${prop.game}</div>
                        <div style="font-size: 12px; color: #64748b;">${gameTime}</div>
                    </div>
                    ${prop.confidence ? `
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${prop.confidence}%"></div>
                        </div>
                        <div class="confidence-text">
                            <span>Confidence: ${prop.confidence}%</span>
                            <span>Pick: ${prop.pick}</span>
                        </div>
                        <div class="lock-time">🔒 Locks in ${hoursToLock}h ${minutesToLock}m</div>
                        <button class="add-to-tracker" onclick="addToTracker('${prop.id}', 'nfl_prop')">
                            Add to Tracker
                        </button>
                    ` : '<div style="text-align: center; margin-top: 20px; color: #64748b;">Run AI Analysis for prediction</div>'}
                </div>
            `;
        }
        
        // Create College Spread Card
        function createCollegeSpreadCard(awayTeam, homeTeam, gameTime, spread, gameId, index) {
            const gradeClass = spread.grade ? `grade-${spread.grade.toLowerCase().replace('+', '-plus').replace('-', '-minus')}` : '';
            const formattedTime = new Date(gameTime).toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            
            return `
                <div class="bet-card">
                    <div class="bet-header">
                        <div class="bet-title">${awayTeam} @ ${homeTeam}</div>
                        ${spread.grade ? `<div class="grade-badge ${gradeClass}">${spread.grade}</div>` : ''}
                    </div>
                    <div class="bet-details">
                        <div>Point Spread</div>
                        <div class="bet-line">${spread.team} ${spread.line > 0 ? '+' : ''}${spread.line}</div>
                        <div class="bet-odds">Odds: ${spread.odds}</div>
                        <div style="margin-top: 8px; font-size: 12px; color: #64748b;">${formattedTime}</div>
                    </div>
                    ${spread.confidence ? `
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${spread.confidence}%"></div>
                        </div>
                        <div class="confidence-text">
                            <span>Confidence: ${spread.confidence}%</span>
                            <span>Edge: ${spread.edge}%</span>
                        </div>
                        <button class="add-to-tracker" onclick="addToTracker('${gameId}_spread_${index}', 'college_spread')">
                            Add to Tracker
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        // Create College Total Card
        function createCollegeTotalCard(awayTeam, homeTeam, gameTime, total, gameId, index) {
            const gradeClass = total.grade ? `grade-${total.grade.toLowerCase().replace('+', '-plus').replace('-', '-minus')}` : '';
            const formattedTime = new Date(gameTime).toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
            
            return `
                <div class="bet-card">
                    <div class="bet-header">
                        <div class="bet-title">${awayTeam} @ ${homeTeam}</div>
                        ${total.grade ? `<div class="grade-badge ${gradeClass}">${total.grade}</div>` : ''}
                    </div>
                    <div class="bet-details">
                        <div>Game Total</div>
                        <div class="bet-line">O/U ${total.line}</div>
                        <div class="bet-odds">Over: ${total.overOdds} | Under: ${total.underOdds}</div>
                        <div style="margin-top: 8px; font-size: 12px; color: #64748b;">${formattedTime}</div>
                    </div>
                    ${total.confidence ? `
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${total.confidence}%"></div>
                        </div>
                        <div class="confidence-text">
                            <span>Confidence: ${total.confidence}%</span>
                            <span>Pick: ${total.pick}</span>
                        </div>
                        <button class="add-to-tracker" onclick="addToTracker('${gameId}_total_${index}', 'college_total')">
                            Add to Tracker
                        </button>
                    ` : ''}
                </div>
            `;
        }
        
        // Render NFL Props with filtering and sorting
        function renderNFLProps() {
            const container = document.getElementById('nflPropsContainer');
            
            if (nflPropsData.length === 0) {
                container.innerHTML = '<div class="loading">No NFL props loaded. Click "Fetch Live Data" to load.</div>';
                return;
            }
            
            // Filter props based on grade
            let filteredProps = nflPropsData.filter(prop => 
                shouldShowGrade(prop.grade, nflFilterMode)
            );
            
            // Sort props
            if (nflSortMode === 'grade') {
                filteredProps.sort((a, b) => {
                    const aRank = gradeRanks[a.grade] || 0;
                    const bRank = gradeRanks[b.grade] || 0;
                    return bRank - aRank;
                });
            } else if (nflSortMode === 'time') {
                filteredProps.sort((a, b) => 
                    new Date(a.gameTime) - new Date(b.gameTime)
                );
            }
            
            if (filteredProps.length === 0) {
                container.innerHTML = '<div class="loading">No props match your filter criteria.</div>';
                return;
            }
            
            container.innerHTML = filteredProps.map(prop => createNFLPropCard(prop)).join('');
        }
        
        // Render College Games with filtering and sorting
        function renderCollegeGames() {
            const container = document.getElementById('collegeContainer');
            
            if (collegeData.length === 0) {
                container.innerHTML = '<div class="loading">No college games loaded. Click "Fetch Live Data" to load.</div>';
                return;
            }
            
            const allBets = [];
            
            collegeData.forEach(game => {
                // Add spread bets
                if (game.spreadAnalysis) {
                    game.spreadAnalysis.forEach((spread, index) => {
                        if (shouldShowGrade(spread.grade, collegeFilterMode)) {
                            allBets.push({
                                type: 'spread',
                                gameTime: game.gameTime,
                                grade: spread.grade,
                                html: createCollegeSpreadCard(game.awayTeam, game.homeTeam, 
                                                             game.gameTime, spread, game.id, index)
                            });
                        }
                    });
                }
                
                // Add total bets
                if (game.totalAnalysis) {
                    game.totalAnalysis.forEach((total, index) => {
                        if (shouldShowGrade(total.grade, collegeFilterMode)) {
                            allBets.push({
                                type: 'total',
                                gameTime: game.gameTime,
                                grade: total.grade,
                                html: createCollegeTotalCard(game.awayTeam, game.homeTeam, 
                                                            game.gameTime, total, game.id, index)
                            });
                        }
                    });
                }
            });
            
            // Sort bets
            if (collegeSortMode === 'grade') {
                allBets.sort((a, b) => {
                    const aRank = gradeRanks[a.grade] || 0;
                    const bRank = gradeRanks[b.grade] || 0;
                    return bRank - aRank;
                });
            } else if (collegeSortMode === 'time') {
                allBets.sort((a, b) => 
                    new Date(a.gameTime) - new Date(b.gameTime)
                );
            }
            
            if (allBets.length === 0) {
                container.innerHTML = '<div class="loading">No bets match your filter criteria.</div>';
                return;
            }
            
            container.innerHTML = allBets.map(bet => bet.html).join('');
        }
        
        // Add bet to tracker
        function addToTracker(betId, betType) {
            let bet;
            
            if (betType === 'nfl_prop') {
                bet = nflPropsData.find(p => p.id === betId);
            } else if (betType.includes('college')) {
                // Find the college bet
                const [gameId, type, index] = betId.split('_');
                const game = collegeData.find(g => g.id === gameId);
                if (type === 'spread') {
                    bet = { ...game, ...game.spreadAnalysis[index], betType: 'spread' };
                } else {
                    bet = { ...game, ...game.totalAnalysis[index], betType: 'total' };
                }
            }
            
            if (bet && !trackedBets.find(b => b.id === betId)) {
                trackedBets.push({
                    ...bet,
                    id: betId,
                    type: betType,
                    addedAt: new Date().toISOString(),
                    status: 'pending'
                });
                
                localStorage.setItem('trackedBets', JSON.stringify(trackedBets));
                updateStatus('Bet added to tracker!');
            }
        }
        
        // Update dashboard
        function updateDashboard() {
            const nflCount = nflPropsData.length;
            const collegeCount = collegeData.length;
            
            // Count A+ bets
            let aPlusCount = 0;
            nflPropsData.forEach(prop => {
                if (prop.grade === 'A+') aPlusCount++;
            });
            
            collegeData.forEach(game => {
                if (game.spreadAnalysis) {
                    game.spreadAnalysis.forEach(s => {
                        if (s.grade === 'A+') aPlusCount++;
                    });
                }
                if (game.totalAnalysis) {
                    game.totalAnalysis.forEach(t => {
                        if (t.grade === 'A+') aPlusCount++;
                    });
                }
            });
            
            // Calculate average edge
            let totalEdge = 0;
            let edgeCount = 0;
            
            nflPropsData.forEach(prop => {
                if (prop.edge) {
                    totalEdge += parseFloat(prop.edge);
                    edgeCount++;
                }
            });
            
            const avgEdge = edgeCount > 0 ? (totalEdge / edgeCount).toFixed(1) : 0;
            
            document.getElementById('nflPropsCount').textContent = nflCount;
            document.getElementById('collegeGamesCount').textContent = collegeCount;
            document.getElementById('aPlusBetsCount').textContent = aPlusCount;
            document.getElementById('avgEdge').textContent = avgEdge > 0 ? `+${avgEdge}%` : `${avgEdge}%`;
        }
        
        // Update results stats
        function updateResultsStats() {
            const wins = trackedBets.filter(b => b.status === 'won').length;
            const losses = trackedBets.filter(b => b.status === 'lost').length;
            const total = wins + losses;
            const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
            
            document.getElementById('overallWinRate').textContent = `${winRate}%`;
            document.getElementById('totalTracked').textContent = trackedBets.length;
            
            // Update grade stats
            updateGradeStats();
            updateBetTypeStats();
        }
        
        // Update grade stats
        function updateGradeStats() {
            const grades = ['A+', 'A', 'A-', 'B+', 'B', 'B-', 'C+', 'C', 'C-', 'D', 'F'];
            const tbody = document.getElementById('gradeStatsBody');
            
            const stats = grades.map(grade => {
                const gradeBets = trackedBets.filter(b => b.grade === grade && b.status !== 'pending');
                const wins = gradeBets.filter(b => b.status === 'won').length;
                const total = gradeBets.length;
                const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
                
                return { grade, winRate, wins, total };
            }).filter(s => s.total > 0);
            
            if (stats.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #64748b;">No completed bets yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = stats.map(s => `
                <tr>
                    <td><span class="grade-badge grade-${s.grade.toLowerCase().replace('+', '-plus').replace('-', '-minus')}">${s.grade}</span></td>
                    <td>${s.winRate}%</td>
                    <td>${s.wins} for ${s.total}</td>
                </tr>
            `).join('');
        }
        
        // Update bet type stats
        function updateBetTypeStats() {
            const tbody = document.getElementById('betTypeStatsBody');
            
            const types = {
                'nfl_prop': 'NFL Props',
                'college_spread': 'College Spreads',
                'college_total': 'College Totals'
            };
            
            const stats = Object.entries(types).map(([key, name]) => {
                const typeBets = trackedBets.filter(b => b.type === key && b.status !== 'pending');
                const wins = typeBets.filter(b => b.status === 'won').length;
                const total = typeBets.length;
                const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;
                
                return { name, winRate, wins, total };
            }).filter(s => s.total > 0);
            
            if (stats.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: #64748b;">No completed bets yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = stats.map(s => `
                <tr>
                    <td>${s.name}</td>
                    <td>${s.winRate}%</td>
                    <td>${s.wins} for ${s.total}</td>
                </tr>
            `).join('');
        }
        
        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateDashboard();
            updateResultsStats();
        });
    </script>
</body>
</html>